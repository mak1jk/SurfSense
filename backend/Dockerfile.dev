FROM python:3.11-bullseye

# Install system dependencies
RUN apt-get update && apt-get install -y \
    gcc \
    libpq-dev \
    libffi-dev \
    python3-dev \
    make \
    pkg-config \
    poppler-utils \
    sqlite3 \
    git \
    curl \
    && rm -rf /var/lib/apt/lists/*

# Install newer version of SQLite
RUN cd /tmp && \
    wget https://www.sqlite.org/2024/sqlite-autoconf-3450000.tar.gz && \
    tar xvfz sqlite-autoconf-3450000.tar.gz && \
    cd sqlite-autoconf-3450000 && \
    ./configure && \
    make && \
    make install && \
    cd .. && \
    rm -rf sqlite-autoconf-3450000* && \
    ldconfig

# Set working directory
WORKDIR /workspace

# Install Python packages for development
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Install additional development tools
RUN pip install --no-cache-dir \
    debugpy \
    pytest \
    black \
    flake8 \
    mypy

# Expose ports for the application and debugger
EXPOSE 8000 5678

# Keep container running
CMD ["tail", "-f", "/dev/null"]
